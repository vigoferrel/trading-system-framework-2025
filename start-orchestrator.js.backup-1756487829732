#!/usr/bin/env node

/**
 * START-ORCHESTRATOR.JS - Script de arranque r√°pido
 * Configuraci√≥n m√≠nima para iniciar el LLM Gemini Supreme Orchestrator
 */

require('dotenv').config({ path: '.env' });
const path = require('path');

// Configurar NODE_PATH para resolver m√≥dulos locales si es necesario
if (!process.env.NODE_PATH) {
  process.env.NODE_PATH = __dirname;
}

async function quickStart() {
  console.log('üåå LLM GEMINI SUPREME ORCHESTRATOR - QUICK START');
  console.log('='.repeat(60));
  console.log('üîÑ Constantes primas integradas: z = 9 + 16i, Œª = ln(7919), 888 MHz');
  console.log('üéØ Optimizaci√≥n de portafolio multis√≠mbolo con gesti√≥n de riesgo');
  console.log('üöÄ Control SRONA y workers cu√°nticos en background');
  console.log('');

  // Verificar dependencias cr√≠ticas
  try {
    const express = require('express');
    console.log('‚úÖ Express disponible');
  } catch (e) {
    console.log('‚ö†Ô∏è  Express no instalado, instalando...');
    require('child_process').execSync('npm install express', { stdio: 'inherit' });
  }

  // Variables de entorno por defecto para testing
  const defaults = {
    BUDGET_USD: '1000',
    PORT: '4602',
    AI_WEIGHT: '0.25',
    VIGO_WEIGHT: '0.25',
    CORE_WEIGHT: '0.50',
    CACHE_TTL_MS: '20000',
    PYTHON_BIN: 'python',
    LOGS_DIR: path.join(__dirname, 'logs'),
    RUN_TEST: 'true'
  };

  // Aplicar defaults solo si no est√°n definidas
  for (const [key, value] of Object.entries(defaults)) {
    if (!process.env[key]) {
      process.env[key] = value;
      console.log(`üìã ${key} = ${value} (default)`);
    }
  }

  // Verificar APIs requeridas
  if (!process.env.BINANCE_API_KEY || !process.env.BINANCE_API_SECRET) {
    console.log('');
    console.log('‚ö†Ô∏è  BINANCE_API_KEY y BINANCE_API_SECRET requeridas');
    console.log('   Ejemplo en .env:');
    console.log('   BINANCE_API_KEY=tu_api_key_aqui');
    console.log('   BINANCE_API_SECRET=tu_api_secret_aqui');
    console.log('');
    console.log('üß™ Continuando en modo TEST (sin APIs reales)...');
    process.env.BINANCE_API_KEY = 'test_key';
    process.env.BINANCE_API_SECRET = 'test_secret';
  }

  // Iniciar el orquestador
  try {
    const { main } = require('./orchestrator/deploy');
    const { orchestrator, logger, server } = await main();
    
    console.log('');
    console.log('üéâ ORQUESTADOR INICIADO EXITOSAMENTE');
    console.log(`üåê API: http://localhost:${process.env.PORT}`);
    console.log('');
    console.log('üìã COMANDOS DE EJEMPLO:');
    console.log(`curl -X GET http://localhost:${process.env.PORT}/health`);
    console.log(`curl -X POST http://localhost:${process.env.PORT}/optimize-intelligent -H "Content-Type: application/json" -d '{"budgetUSD":1000}'`);
    console.log(`curl -X POST http://localhost:${process.env.PORT}/optimize-portfolio -H "Content-Type: application/json" -d '{"budgetUSD":1000}'`);
    console.log(`curl -X POST http://localhost:${process.env.PORT}/background/launch-srona`);
    console.log(`curl -X GET http://localhost:${process.env.PORT}/background/status`);
    
  } catch (error) {
    console.error('‚ùå Error iniciando orquestador:', error.message);
    process.exit(1);
  }
}

// Funci√≥n para mostrar ayuda
function showHelp() {
  console.log(`
üåå LLM GEMINI SUPREME ORCHESTRATOR - HELP
${'='.repeat(50)}

VARIABLES DE ENTORNO:
  BUDGET_USD=1000          # Presupuesto por defecto en USD
  PORT=3001               # Puerto del servidor API
  AI_WEIGHT=0.25          # Peso se√±ales AI (0-1)
  VIGO_WEIGHT=0.25        # Peso se√±ales Vigo (0-1)  
  CORE_WEIGHT=0.50        # Peso se√±ales core cu√°nticas (0-1)
  CACHE_TTL_MS=20000      # TTL cache en milliseconds
  PYTHON_BIN=python       # Binario Python para SRONA
  BINANCE_API_KEY=...     # API Key de Binance
  BINANCE_API_SECRET=...  # API Secret de Binance
  RUN_TEST=true           # Ejecutar prueba inicial

COMANDOS:
  node start-orchestrator.js        # Arranque r√°pido
  node start-orchestrator.js --help # Esta ayuda
  node orchestrator/deploy.js       # Arranque directo

ESTRUCTURA:
  orchestrator/
    ‚îú‚îÄ‚îÄ LLM_GEMINI_SUPREME_ORCHESTRATOR.js  # Orquestador principal
    ‚îî‚îÄ‚îÄ deploy.js                           # Script de despliegue
  LeonardoLeverageMatrix.js                 # Gesti√≥n de riesgo y leverage
  workers/quantum-worker.js                 # Worker de scoring cu√°ntico
  quantum/SRONA_*.py                        # Scripts Python SRONA

CONSTANTES PRIMAS:
  z = 9 + 16i            # N√∫mero complejo base
  Œª = ln(7919)          # Frecuencia logar√≠tmica
  888 MHz               # Resonancia cu√°ntica
  9973                  # Primo para hashing
`);
}

// Ejecutar
if (require.main === module) {
  const args = process.argv.slice(2);
  if (args.includes('--help') || args.includes('-h')) {
    showHelp();
  } else {
    quickStart().catch(console.error);
  }
}

module.exports = { quickStart, showHelp };
