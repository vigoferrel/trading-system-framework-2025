#!/usr/bin/env python3
"""
VERIFICACIÃ“N RÃPIDA - SISTEMA QBTC BANDA 46
Script para verificar el estado de todos los servicios
"""

import requests
import time
from datetime import datetime

def print_banner():
    """Imprime el banner del sistema."""
    print("=" * 80)
    print("[SEARCH] VERIFICACIÃ“N RÃPIDA - SISTEMA QBTC BANDA 46")
    print("=" * 80)
    print(f"ðŸ“… Fecha: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print("[ENDPOINTS] Banda: 46")
    print("ðŸ”— Puertos: 4601-4606")
    print("=" * 80)

def check_service(name, url, endpoint=""):
    """Verifica un servicio especÃ­fico."""
    try:
        full_url = f"{url}{endpoint}"
        response = requests.get(full_url, timeout=5)
        
        if response.status_code == 200:
            print(f"[OK] {name} - {full_url} - FUNCIONANDO")
            return True
        else:
            print(f"[ERROR] {name} - {full_url} - ERROR {response.status_code}")
            return False
            
    except requests.exceptions.RequestException as e:
        print(f"[ERROR] {name} - {url} - NO RESPONDE: {e}")
        return False

def main():
    """FunciÃ³n principal."""
    print_banner()
    
    services = [
        {
            "name": "SRONA API",
            "url": "http://localhost:4601",
            "endpoint": "/health"
        },
        {
            "name": "QBTC Core",
            "url": "http://localhost:4602",
            "endpoint": "/api/futures-data"
        },
        {
            "name": "Frontend API",
            "url": "http://localhost:4603",
            "endpoint": "/health"
        },
        {
            "name": "Vigo Futures",
            "url": "http://localhost:4604",
            "endpoint": "/health"
        },
        {
            "name": "Dashboard QBTC",
            "url": "http://localhost:4605",
            "endpoint": "/"
        },
        {
            "name": "Monitor de GrÃ¡ficos",
            "url": "http://localhost:4606",
            "endpoint": "/"
        }
    ]
    
    print("[SEARCH] VERIFICANDO SERVICIOS")
    print("-" * 50)
    
    working_services = 0
    total_services = len(services)
    
    for service in services:
        if check_service(service["name"], service["url"], service["endpoint"]):
            working_services += 1
        time.sleep(0.5)
    
    print("\n" + "=" * 80)
    print("[DATA] RESUMEN DEL SISTEMA")
    print("=" * 80)
    
    print(f"[OK] Servicios funcionando: {working_services}/{total_services}")
    
    if working_services == total_services:
        print("ðŸŽ‰ Â¡SISTEMA COMPLETAMENTE FUNCIONAL!")
        print("[START] Todos los servicios estÃ¡n respondiendo correctamente")
    elif working_services > 0:
        print("[WARNING] SISTEMA PARCIALMENTE FUNCIONAL")
        print(f"ðŸ”§ {working_services} de {total_services} servicios funcionando")
    else:
        print("[ERROR] SISTEMA NO FUNCIONAL")
        print("ðŸ”§ NingÃºn servicio estÃ¡ respondiendo")
    
    print("\n[API] ACCESO A SERVICIOS:")
    print("â€¢ SRONA API: http://localhost:4601")
    print("â€¢ QBTC Core: http://localhost:4602")
    print("â€¢ Frontend API: http://localhost:4603")
    print("â€¢ Vigo Futures: http://localhost:4604")
    print("â€¢ Dashboard QBTC: http://localhost:4605")
    print("â€¢ Monitor de GrÃ¡ficos: http://localhost:4606")
    
    print("\n[LIST] COMANDOS ÃšTILES:")
    print("â€¢ Verificar: python verificar-sistema.py")
    print("â€¢ Detener: taskkill /F /IM python.exe & taskkill /F /IM node.exe")
    print("â€¢ Reiniciar: python deploy-banda-46-simple.py")
    
    print("\n" + "=" * 80)

if __name__ == "__main__":
    main()
