#!/usr/bin/env python3
"""
ğŸ§  TEST MONITOR MAXIMIZADO - QBTC SISTEMA COMPLETO
==================================================
Script de prueba para verificar que el monitor maximizado estÃ¡ funcionando
correctamente con todas las capacidades del sistema integradas:
- Motor de Feynman Path Integrals
- Transformaciones primas avanzadas
- AnÃ¡lisis neural completo
- Sistema unificado primo-cuÃ¡ntico
"""

import requests
import json
import time
from datetime import datetime

# ConfiguraciÃ³n del monitor
MONITOR_URL = "http://localhost:4606"

def test_endpoint(endpoint, description):
    """Prueba un endpoint especÃ­fico del monitor."""
    try:
        print(f"\nğŸ” Probando: {description}")
        print(f"   Endpoint: {endpoint}")
        
        response = requests.get(f"{MONITOR_URL}{endpoint}", timeout=10)
        
        if response.status_code == 200:
            data = response.json()
            if data.get('success'):
                print(f"   âœ… Ã‰XITO: {description}")
                print(f"   ğŸ“Š Datos recibidos: {len(str(data))} caracteres")
                
                # Mostrar mÃ©tricas clave si estÃ¡n disponibles
                if 'data' in data:
                    if 'quantum_metrics' in data['data']:
                        metrics = data['data']['quantum_metrics']
                        print(f"   ğŸ§® MÃ©tricas cuÃ¡nticas: fase={metrics.get('phase', 'N/A')}, magnitud={metrics.get('magnitude', 'N/A')}")
                    
                    if 'timestamp' in data['data']:
                        print(f"   â° Timestamp: {data['data']['timestamp']}")
                
                return True
            else:
                print(f"   âŒ ERROR: Respuesta no exitosa")
                print(f"   ğŸ“„ Respuesta: {data}")
                return False
        else:
            print(f"   âŒ ERROR: Status code {response.status_code}")
            return False
            
    except requests.exceptions.Timeout:
        print(f"   â° TIMEOUT: {description}")
        return False
    except requests.exceptions.ConnectionError:
        print(f"   ğŸ”Œ CONNECTION ERROR: {description}")
        return False
    except Exception as e:
        print(f"   ğŸ’¥ ERROR: {description} - {str(e)}")
        return False

def test_monitor_maximizado():
    """Prueba completa del monitor maximizado."""
    print("ğŸ§  TEST MONITOR MAXIMIZADO - QBTC SISTEMA COMPLETO")
    print("=" * 60)
    print(f"â° Iniciando pruebas: {datetime.now().isoformat()}")
    print(f"ğŸŒ Monitor URL: {MONITOR_URL}")
    
    # Lista de endpoints a probar
    endpoints = [
        ("/api/health", "Estado de salud del monitor"),
        ("/api/neural-recommendations", "Recomendaciones neuronales integradas"),
        ("/api/session-state", "Estado de sesiones neuronales"),
        ("/api/psychological-analysis", "AnÃ¡lisis psicolÃ³gico"),
        ("/api/quantum-metrics", "MÃ©tricas cuÃ¡nticas"),
        ("/api/neural-stack-status", "Estado del stack neural"),
        ("/api/futures-multi-sector", "AnÃ¡lisis multi-sector de futures"),
        ("/api/futures-sector-analysis", "AnÃ¡lisis por sector"),
        ("/api/futures-top-opportunities", "Mejores oportunidades de futures"),
        ("/api/futures-orchestrator-status", "Estado del orquestador de futures"),
        ("/api/feynman-engine-status", "Estado del motor de Feynman"),
        ("/api/prime-transformations", "Transformaciones primas"),
        ("/api/neural-projections", "Proyecciones neurales"),
        ("/api/quantum-timeframes", "Timeframes cuÃ¡nticos"),
        ("/api/leonardo-consciousness", "Consciencia Leonardo"),
        ("/api/fibonacci-waves", "Ondas Fibonacci"),
        ("/api/lunar-orbital", "AnÃ¡lisis orbital lunar"),
        ("/api/halving-gravitational", "AnÃ¡lisis gravitacional de halving"),
        ("/api/session-flow", "Flujo de sesiones"),
        ("/api/quantum-interference", "Interferencia cuÃ¡ntica"),
        ("/api/prime-cycles", "Ciclos primos"),
        ("/api/unified-prime-quantum", "Sistema unificado primo-cuÃ¡ntico")
    ]
    
    # Contadores de resultados
    total_tests = len(endpoints)
    successful_tests = 0
    failed_tests = 0
    
    # Ejecutar pruebas
    for endpoint, description in endpoints:
        if test_endpoint(endpoint, description):
            successful_tests += 1
        else:
            failed_tests += 1
        time.sleep(0.5)  # Pausa entre pruebas
    
    # Resumen de resultados
    print("\n" + "=" * 60)
    print("ğŸ“Š RESUMEN DE PRUEBAS")
    print("=" * 60)
    print(f"âœ… Pruebas exitosas: {successful_tests}/{total_tests}")
    print(f"âŒ Pruebas fallidas: {failed_tests}/{total_tests}")
    print(f"ğŸ“ˆ Tasa de Ã©xito: {(successful_tests/total_tests)*100:.1f}%")
    
    if successful_tests == total_tests:
        print("\nğŸ‰ Â¡TODAS LAS PRUEBAS EXITOSAS!")
        print("ğŸš€ El monitor maximizado estÃ¡ funcionando correctamente")
        print("ğŸ§  Todas las capacidades del sistema estÃ¡n integradas")
    elif successful_tests > total_tests * 0.8:
        print("\nâš ï¸  La mayorÃ­a de las pruebas exitosas")
        print("ğŸ”§ Algunos endpoints pueden necesitar ajustes")
    else:
        print("\nâŒ Muchas pruebas fallidas")
        print("ğŸ”§ El monitor necesita revisiÃ³n")
    
    return successful_tests == total_tests

def test_specific_capabilities():
    """Prueba capacidades especÃ­ficas del sistema."""
    print("\nğŸ”¬ PRUEBAS DE CAPACIDADES ESPECÃFICAS")
    print("=" * 60)
    
    # Probar motor de Feynman
    print("\nğŸ§® Probando motor de Feynman...")
    try:
        response = requests.get(f"{MONITOR_URL}/api/feynman-engine-status", timeout=10)
        if response.status_code == 200:
            data = response.json()
            if data.get('success') and 'data' in data:
                feynman_data = data['data']
                print(f"   âœ… Motor de Feynman: {feynman_data.get('status', 'N/A')}")
                print(f"   ğŸ§® Tipo: {feynman_data.get('engine_type', 'N/A')}")
                if 'quantum_constants' in feynman_data:
                    constants = feynman_data['quantum_constants']
                    print(f"   ğŸ“Š Z real: {constants.get('z_real', 'N/A')}, Z imag: {constants.get('z_imag', 'N/A')}")
    except Exception as e:
        print(f"   âŒ Error probando motor de Feynman: {e}")
    
    # Probar transformaciones primas
    print("\nğŸ”¢ Probando transformaciones primas...")
    try:
        response = requests.get(f"{MONITOR_URL}/api/prime-transformations", timeout=10)
        if response.status_code == 200:
            data = response.json()
            if data.get('success') and 'data' in data:
                prime_data = data['data']
                print(f"   âœ… Transformaciones primas disponibles")
                if 'core_primes' in prime_data:
                    primes = prime_data['core_primes']
                    print(f"   ğŸ”¢ Primos: {list(primes.keys())}")
    except Exception as e:
        print(f"   âŒ Error probando transformaciones primas: {e}")
    
    # Probar sistema unificado
    print("\nğŸŒ Probando sistema unificado primo-cuÃ¡ntico...")
    try:
        response = requests.get(f"{MONITOR_URL}/api/unified-prime-quantum", timeout=10)
        if response.status_code == 200:
            data = response.json()
            if data.get('success') and 'data' in data:
                unified_data = data['data']
                print(f"   âœ… Sistema unificado disponible")
                print(f"   ğŸ“Š Score unificado: {unified_data.get('unified_score', 'N/A')}")
                if 'systems' in unified_data:
                    systems = unified_data['systems']
                    print(f"   ğŸ§  Sistemas integrados: {list(systems.keys())}")
    except Exception as e:
        print(f"   âŒ Error probando sistema unificado: {e}")

if __name__ == "__main__":
    try:
        # Prueba principal
        success = test_monitor_maximizado()
        
        # Pruebas especÃ­ficas
        test_specific_capabilities()
        
        print(f"\nğŸ Pruebas completadas: {datetime.now().isoformat()}")
        
    except KeyboardInterrupt:
        print("\nâ¹ï¸  Pruebas interrumpidas por el usuario")
    except Exception as e:
        print(f"\nğŸ’¥ Error general en las pruebas: {e}")
